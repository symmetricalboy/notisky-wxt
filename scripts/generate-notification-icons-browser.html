<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notification Badge Generator</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            color: #333;
        }
        h1 {
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        .button-container {
            display: flex;
            gap: 10px;
        }
        button {
            padding: 10px 15px;
            background-color: #4a90e2;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background-color: #357ae8;
        }
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        .download-all {
            margin-top: 20px;
            background-color: #28a745;
        }
        .download-all:hover {
            background-color: #218838;
        }
        .progress {
            margin-top: 10px;
            height: 20px;
            background-color: #f5f5f5;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: #4a90e2;
            transition: width 0.3s ease;
            text-align: center;
            line-height: 20px;
            color: white;
        }
        .preview-container {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
        }
        .icon-preview {
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 4px;
            text-align: center;
            background-color: #fdfdfd;
        }
        .icon-preview img {
            display: block;
            margin: 0 auto 5px;
        }
        .icon-preview span {
            font-size: 12px;
            color: #666;
            display: block;
            word-break: break-all;
        }
        .download-links {
            margin-top: 20px;
        }
        .download-btn {
            display: block;
            margin-bottom: 8px;
            text-decoration: none;
            color: #4a90e2;
        }
        .instructions {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .instructions code {
            background-color: #f1f1f1;
            padding: 2px 4px;
            border-radius: 3px;
            font-family: monospace;
        }
        .zip-link {
            margin-top: 20px;
            text-align: center;
        }
        .hidden {
            display: none;
        }
        .status-message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status-message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status-message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-message.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeeba;
        }
    </style>
</head>
<body>
    <h1>Notisky Notification Badge Generator</h1>
    
    <div class="container">
        <p>
            This tool generates standalone notification badges (red circles with white numbers) from 1 to 30 and "30+". 
            These badges will replace the extension icon completely when there are notifications.
        </p>
        
        <div id="status-message" class="status-message"></div>
        
        <div class="button-container">
            <button id="generate-btn">Generate All Badges</button>
            <button id="download-zip-btn" class="download-all" disabled>Download All Badges as ZIP</button>
        </div>
        
        <div id="progress-container" class="hidden">
            <div class="progress">
                <div id="progress-bar" class="progress-bar" style="width: 0%">0%</div>
            </div>
        </div>
        
        <div id="preview-container" class="preview-container"></div>
        <div id="download-links" class="download-links"></div>
        
        <div class="instructions">
            <h3>How to use these badges:</h3>
            <ol>
                <li>Click "Generate All Badges" to create the notification badges</li>
                <li>Click "Download All Badges as ZIP" to download all the badges in one file</li>
                <li>Extract the ZIP and place the badges in your extension's <code>/public/icon/notification/</code> folder</li>
            </ol>
        </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <script>
        // Counts to generate
        const countsToGenerate = [
            1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 
            11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
            21, 22, 23, 24, 25, 26, 27, 28, 29, 30, '30plus'
        ];
        const iconSizes = [16, 32, 48, 128];
        
        // Store generated icons
        const generatedIcons = {};
        
        // DOM elements
        const generateBtn = document.getElementById('generate-btn');
        const downloadZipBtn = document.getElementById('download-zip-btn');
        const progressContainer = document.getElementById('progress-container');
        const progressBar = document.getElementById('progress-bar');
        const previewContainer = document.getElementById('preview-container');
        const downloadLinks = document.getElementById('download-links');
        const statusMessage = document.getElementById('status-message');
        
        // Function to show status message
        function showStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
            
            // Clear after 5 seconds for success or info messages
            if (type !== 'error') {
                setTimeout(() => {
                    statusMessage.textContent = '';
                    statusMessage.className = 'status-message';
                }, 5000);
            }
        }
        
        // Function to generate a notification badge
        async function generateBadge(count, size) {
            // Create canvas
            const canvas = document.createElement('canvas');
            canvas.width = size;
            canvas.height = size;
            const ctx = canvas.getContext('2d');
            
            // Create a transparent background
            ctx.clearRect(0, 0, size, size);
            
            // Calculate badge size to fill most of the icon space
            const badgeSize = Math.max(size * 0.9, 14); // 90% of icon size
            const badgeX = size / 2; // Center horizontally
            const badgeY = size / 2; // Center vertically
            
            // Draw red circle background
            ctx.beginPath();
            ctx.arc(badgeX, badgeY, badgeSize/2, 0, Math.PI * 2);
            ctx.fillStyle = '#FF4A4A'; // Red badge color
            ctx.fill();
            
            // Format count text
            let countText;
            if (count === '30plus') {
                countText = '30+';
            } else {
                countText = count.toString();
            }
            
            // Add white text
            ctx.fillStyle = '#FFFFFF';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            
            // Scale font size based on badge size and character count
            const fontSize = Math.max(badgeSize * 0.5, 7); // 50% of badge size
            ctx.font = `bold ${fontSize}px Arial`;
            
            // Adjust font size if text is too long
            if (countText.length > 1) {
                ctx.font = `bold ${fontSize * 0.8}px Arial`;
            }
            if (countText.length > 2) {
                ctx.font = `bold ${fontSize * 0.7}px Arial`;
            }
            
            ctx.fillText(countText, badgeX, badgeY);
            
            // Convert to data URL and return
            const dataUrl = canvas.toDataURL('image/png');
            
            // Create preview element
            const previewDiv = document.createElement('div');
            previewDiv.className = 'icon-preview';
            
            const previewImg = document.createElement('img');
            previewImg.src = dataUrl;
            previewImg.width = size;
            previewImg.height = size;
            
            const previewCaption = document.createElement('span');
            previewCaption.textContent = `${count}_${size}.png`;
            
            previewDiv.appendChild(previewImg);
            previewDiv.appendChild(previewCaption);
            previewContainer.appendChild(previewDiv);
            
            // Create download link
            const downloadLink = document.createElement('a');
            downloadLink.href = dataUrl;
            downloadLink.download = `${count}_${size}.png`;
            downloadLink.className = 'download-btn';
            downloadLink.textContent = `Download ${count}_${size}.png`;
            downloadLinks.appendChild(downloadLink);
            
            // Store for later use
            if (!generatedIcons[count]) {
                generatedIcons[count] = {};
            }
            generatedIcons[count][size] = dataUrl;
            
            return dataUrl;
        }
        
        // Function to generate all notification badges
        async function generateAllBadges() {
            // Clear previous content
            previewContainer.innerHTML = '';
            downloadLinks.innerHTML = '';
            
            // Show progress
            progressContainer.classList.remove('hidden');
            generateBtn.disabled = true;
            
            showStatus('Generating badges...', 'info');
            
            const totalIcons = countsToGenerate.length * iconSizes.length;
            let completedIcons = 0;
            
            // Generate badges for each count and size
            for (const count of countsToGenerate) {
                for (const size of iconSizes) {
                    await generateBadge(count, size);
                    
                    // Update progress
                    completedIcons++;
                    const progressPercent = Math.floor((completedIcons / totalIcons) * 100);
                    progressBar.style.width = `${progressPercent}%`;
                    progressBar.textContent = `${progressPercent}%`;
                }
            }
            
            // Enable download all button
            downloadZipBtn.disabled = false;
            showStatus('All badges generated successfully!', 'success');
            generateBtn.disabled = false;
        }
        
        // Function to download all badges as ZIP
        async function downloadAllAsZip() {
            showStatus('Creating ZIP file...', 'info');
            const zip = new JSZip();
            
            // Add all badges to the ZIP
            for (const count of countsToGenerate) {
                for (const size of iconSizes) {
                    if (generatedIcons[count] && generatedIcons[count][size]) {
                        // Convert data URL to blob
                        const dataUrl = generatedIcons[count][size];
                        const binary = atob(dataUrl.split(',')[1]);
                        const array = [];
                        for (let i = 0; i < binary.length; i++) {
                            array.push(binary.charCodeAt(i));
                        }
                        const blob = new Blob([new Uint8Array(array)], {type: 'image/png'});
                        
                        // Add to ZIP
                        zip.file(`${count}_${size}.png`, blob);
                    }
                }
            }
            
            // Generate ZIP and trigger download
            zip.generateAsync({type: 'blob'}).then(function(content) {
                saveAs(content, 'notisky-notification-badges.zip');
                showStatus('ZIP file download started!', 'success');
            }).catch(error => {
                showStatus('Error creating ZIP file: ' + error.message, 'error');
            });
        }
        
        // Event listeners
        generateBtn.addEventListener('click', generateAllBadges);
        downloadZipBtn.addEventListener('click', downloadAllAsZip);
    </script>
</body>
</html> 