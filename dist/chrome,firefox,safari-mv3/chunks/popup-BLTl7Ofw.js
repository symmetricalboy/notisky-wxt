import{r as h,j as s,b as o,a as b,R as k}from"./browser-Bh6BCD6u.js";function C(){const[g,r]=h.useState([]),[x,f]=h.useState(!0),[j,m]=h.useState(!1);h.useEffect(()=>{(async()=>{try{f(!0);const a=async()=>{try{const t=await fetch("https://notisky.symm.app/api/status",{method:"GET",headers:{"Content-Type":"application/json"},mode:"cors"});if(t.ok){const u=await t.json();m(u.success===!0)}else m(!1)}catch(t){console.error("Error checking server connection:",t),m(!1)}},{accounts:c=[]}=await o.storage.local.get("accounts"),n=(await o.tabs.query({active:!0,currentWindow:!0}))[0];if(n!=null&&n.url&&(n.url.includes("bsky.app")||n.url.includes("bsky.social")))try{await o.tabs.sendMessage(n.id,{action:"checkForUpdates"})}catch(t){console.log("Unable to refresh counts from Bluesky tab:",t)}const d=await o.storage.local.get(["notificationCounts","accountNotifications"]);if(d.accountNotifications&&Array.isArray(d.accountNotifications)){const t=c.map(u=>{const i=d.accountNotifications.find(v=>v.did===u.did);return{...u,counts:i?{notification:i.notification||0,message:i.message||0,total:(i.notification||0)+(i.message||0)}:{notification:0,message:0,total:0}}});r(t)}else{const t=d.notificationCounts||{notification:0,message:0,total:0};c.length>0?c.length===1?r([{...c[0],counts:t}]):r(c):r([])}await a()}catch(a){console.error("Error loading data:",a)}finally{f(!1)}})()},[]);const l=e=>{o.tabs.create({url:`https://bsky.app${e}`}),window.close()},N=()=>{o.runtime.openOptionsPage(),window.close()},y=()=>{o.tabs.create({url:"https://notisky.symm.app"}),window.close()},p=e=>e>99?"badge-counter large-number":"badge-counter";return s.jsxs("div",{className:"popup-container",children:[s.jsxs("div",{className:"popup-header",children:[s.jsx("img",{src:"/icon/48.png",alt:"Notisky Logo",className:"logo"}),s.jsx("h1",{children:"Notisky"})]}),x?s.jsxs("div",{className:"loading-container",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Checking for notifications..."})]}):s.jsxs(s.Fragment,{children:[g.length>0?s.jsx("div",{className:"accounts-container",children:g.map((e,a)=>s.jsxs("div",{className:"account-card",children:[s.jsx("div",{className:"account-header",children:s.jsxs("span",{className:"account-handle",children:["@",e.handle]})}),s.jsxs("div",{className:"notification-summary",children:[s.jsxs("div",{className:"count-container",children:[s.jsxs("div",{className:"count-item badge-container",onClick:()=>l(`/profile/${e.handle}/notifications`),children:[s.jsx("div",{className:"count-label",children:"Notifications"}),e.counts&&e.counts.notification>0&&s.jsx("div",{className:p(e.counts.notification),children:e.counts.notification>99?"99+":e.counts.notification})]}),s.jsxs("div",{className:"count-item badge-container",onClick:()=>l("/messages"),children:[s.jsx("div",{className:"count-label",children:"Messages"}),e.counts&&e.counts.message>0&&s.jsx("div",{className:p(e.counts.message),children:e.counts.message>99?"99+":e.counts.message})]})]}),s.jsxs("div",{className:"total-count badge-container",children:[s.jsx("span",{children:"Total:"}),e.counts&&e.counts.total>0&&s.jsx("div",{className:p(e.counts.total),children:e.counts.total>99?"99+":e.counts.total})]})]})]},a))}):s.jsxs("div",{className:"no-accounts",children:[s.jsx("p",{children:"No Bluesky accounts connected."}),s.jsx("p",{children:"Connect your accounts through the Auth Portal."})]}),s.jsx("div",{className:"server-status",children:s.jsx("div",{className:`status-indicator ${j?"connected":"error"}`,children:j?"Connected to Auth Server":"Not connected to Auth Server"})})]}),s.jsxs("div",{className:"popup-actions",children:[s.jsx("button",{className:"action-button primary",onClick:()=>l("/"),children:"Open Bluesky"}),s.jsx("button",{className:"action-button secondary",onClick:y,children:"Auth Portal"}),s.jsx("button",{className:"action-button secondary",onClick:N,children:"Options"})]}),s.jsxs("footer",{className:"popup-footer",children:[s.jsx("p",{className:"footer-slogan",children:"Free & open source, for all, forever."}),s.jsxs("p",{className:"footer-contact",children:["Feedback, suggestions, assistance, & updates:",s.jsx("a",{href:"#",onClick:e=>{e.preventDefault(),l("/profile/symm.app")},children:"@symm.app"})]}),s.jsx("p",{className:"footer-copyright",children:"Copyright (c) 2025 Dylan Gregori Singer (symmetricalboy)"})]})]})}b.createRoot(document.getElementById("root")).render(s.jsx(k.StrictMode,{children:s.jsx(C,{})}));
